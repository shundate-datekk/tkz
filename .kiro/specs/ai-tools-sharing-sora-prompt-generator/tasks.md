# 実装計画

- [ ] 1. プロジェクト基盤とインフラストラクチャのセットアップ
- [x] 1.1 Next.js 15プロジェクトの初期化とTypeScript設定
  - Next.js 15をApp Routerモードで初期化
  - TypeScript、ESLint、Prettierの設定
  - 必要な依存関係をインストール（React 18、Tailwind CSS v4、shadcn/ui）
  - 基本的なディレクトリ構造を作成
  - _Requirements: 全要件に共通する基盤_

- [x] 1.2 環境変数とSupabase接続の設定
  - 環境変数管理の設定（.env.local）
  - Supabaseプロジェクトを作成し、接続情報を設定
  - Supabase Clientの初期化とテスト接続
  - 環境変数の型定義
  - _Requirements: 全要件に共通するデータベース接続_

- [x] 1.3 データベーススキーマとマイグレーションの作成
  - usersテーブルの作成（id, username, display_name, password_hash）
  - ai_toolsテーブルの作成（全カラムとインデックス）
  - prompt_historyテーブルの作成（全カラムとインデックス）
  - sessionsテーブルの作成（NextAuth.js用）
  - 全文検索インデックスの作成
  - Row Level Securityポリシーの設定
  - _Requirements: 1.1-1.6, 2.1-2.5, 3.1-3.6, 4.1-4.6, 5.1-5.6_

- [x] 1.4 デザインシステムとUIコンポーネントライブラリのセットアップ
  - Tailwind CSS v4の設定とカスタムテーマ定義
  - shadcn/uiの初期化と基本コンポーネントのインストール
  - カラースキーム、フォント、スペーシングの定義
  - レスポンシブブレークポイントの設定
  - _Requirements: 7.3, 7.5_

- [ ] 2. 認証システムの構築
- [x] 2.1 NextAuth.js認証の基盤実装
  - NextAuth.js v5のインストールと設定
  - Credentials Providerの設定
  - セッション管理の設定（24時間有効期限）
  - 認証APIルートの作成
  - _Requirements: 5.1, 5.2, 5.3_

- [x] 2.2 ユーザー登録とパスワード管理機能の実装
  - 初期ユーザー（TKZ、コボちゃん）のシードデータ作成
  - bcryptによるパスワードハッシュ化機能
  - パスワード検証機能
  - ユーザーリポジトリの実装
  - _Requirements: 5.3, 5.4_

- [x] 2.3 ログイン・ログアウトUIとフローの実装
  - ログイン画面のUI作成（username、passwordフィールド）
  - ログインフォームのバリデーション
  - ログイン処理のServer Action実装
  - ログアウト機能の実装
  - セッション期限切れ時のリダイレクト処理
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 2.4 認証ミドルウェアとアクセス制御の実装
  - Next.js Middlewareでのセッション検証
  - 保護されたルートの定義
  - 未認証時のログイン画面リダイレクト
  - Server Actionsでの認証チェック
  - _Requirements: 5.1, 5.6_

- [ ] 3. AIツール情報管理機能の構築
- [x] 3.1 AIツールデータモデルとリポジトリの実装
  - AITool型定義とZodスキーマの作成
  - ToolRepositoryの実装（CRUD操作）
  - データベースクエリの最適化
  - 論理削除（deletedAtフラグ）の実装
  - _Requirements: 1.1-1.6_

- [x] 3.2 AIツール管理サービスレイヤーの実装
  - ToolManagementServiceの実装
  - バリデーションロジック（Zod）
  - Result型パターンの実装
  - エラーハンドリング
  - _Requirements: 1.1-1.6_

- [x] 3.3 AIツール登録フォームUIの実装
  - ツール登録画面のレイアウト作成
  - フォームフィールド（ツール名、カテゴリ、使用目的、使用感、評価、使用日時）
  - react-hook-formでのフォーム管理
  - リアルタイムバリデーションとエラー表示
  - 入力例とヘルプテキストの表示
  - _Requirements: 1.1, 7.5_

- [x] 3.4 AIツール登録処理とOptimistic UIの実装
  - ツール登録のServer Action実装
  - useOptimistic hookで楽観的UI更新
  - 登録成功時のフィードバック表示
  - エラー時のロールバック処理
  - _Requirements: 1.2, 7.4_

- [x] 3.5 AIツール一覧表示とページネーションの実装
  - ツール一覧画面のServer Component実装
  - データフェッチングとキャッシング
  - カード形式またはテーブル形式での表示
  - 登録者名の表示（TKZ/コボちゃん）
  - レスポンシブレイアウト
  - _Requirements: 1.3, 6.1, 6.2, 7.1, 7.2_

- [x] 3.6 AIツール編集・削除機能の実装
  - 編集ボタンと削除ボタンのUI
  - 編集フォームへの既存データのプリフィル
  - 更新処理のServer Action
  - 削除確認ダイアログの実装
  - 他ユーザーのツール編集時の確認ダイアログ
  - _Requirements: 1.4, 1.5, 1.6, 6.5_

- [ ] 4. 検索・フィルタリング機能の実装
- [ ] 4.1 クライアント側検索機能の実装
  - 検索ボックスUIの作成
  - リアルタイム検索のClient Component実装
  - ツール名、使用目的、使用感でのキーワード検索
  - 大文字小文字を区別しない検索
  - _Requirements: 2.1, 2.2_

- [ ] 4.2 カテゴリフィルタとソート機能の実装
  - カテゴリ選択UIの作成
  - フィルタリングロジックの実装
  - 評価順・使用日時順のソート機能
  - 検索とフィルタの複合条件処理
  - _Requirements: 2.1, 2.3, 2.4, 2.5_

- [ ] 4.3 検索結果のUI更新とパフォーマンス最適化
  - 検索結果の即座の表示更新
  - デバウンス処理による最適化
  - 検索中のローディング表示
  - 検索結果がない場合のメッセージ表示
  - _Requirements: 2.2, 2.4, 7.4_

- [ ] 5. Sora2プロンプト生成機能の構築
- [ ] 5.1 OpenAI API統合とクライアントの実装
  - OpenAI SDKのインストールと設定
  - OpenAIClientの実装（generateVideoPrompt）
  - APIキーの環境変数管理
  - エラーハンドリングとリトライロジック
  - レート制限対策
  - _Requirements: 3.1-3.6_

- [ ] 5.2 プロンプト生成サービスの実装
  - PromptGenerationServiceの実装
  - 入力パラメータのバリデーション（Zod）
  - System promptとFew-shot examplesの設計
  - GPT-4へのリクエスト構築（temperature=0.7）
  - 生成結果のパース処理
  - _Requirements: 3.2, 3.6_

- [ ] 5.3 プロンプト生成フォームUIの実装
  - プロンプト生成画面のレイアウト作成
  - フォームフィールド（目的、シーン説明、スタイル、長さ、その他要望）
  - 必須項目のバリデーション
  - 入力例とプレースホルダーの表示
  - _Requirements: 3.1, 7.5_

- [ ] 5.4 プロンプト生成処理とローディング表示の実装
  - 生成ボタンのServer Action実装
  - 生成中のローディングUI表示
  - 生成完了時のプロンプト表示
  - エラー時のフィードバック
  - _Requirements: 3.2, 7.4_

- [ ] 5.5 プロンプト表示と再生成機能の実装
  - 生成されたプロンプトの表示UI
  - コピーボタンとクリップボードコピー機能
  - コピー完了メッセージの表示
  - 再生成ボタンの実装
  - 再生成時のバリエーション生成
  - _Requirements: 3.2, 3.3, 3.4, 3.5, 3.6_

- [ ] 6. プロンプト履歴管理機能の実装
- [ ] 6.1 プロンプト履歴リポジトリの実装
  - PromptHistory型定義とZodスキーマ
  - PromptRepositoryの実装（保存、取得、検索）
  - JSONBフィールドの扱い
  - 全文検索クエリの実装
  - _Requirements: 4.1-4.6_

- [ ] 6.2 プロンプト保存機能の実装
  - 保存ボタンのUI作成
  - プロンプト保存のServer Action
  - 入力パラメータのJSON保存
  - 生成日時の記録
  - 保存成功フィードバック
  - _Requirements: 4.1, 6.3, 6.4_

- [ ] 6.3 プロンプト履歴一覧表示の実装
  - 履歴一覧画面のServer Component実装
  - 生成日時の新しい順でのソート
  - 作成者名の表示（TKZ/コボちゃん）
  - カード形式でのプレビュー表示
  - ページネーションまたは無限スクロール
  - _Requirements: 4.2, 6.3, 6.4_

- [ ] 6.4 プロンプト履歴の詳細表示と操作の実装
  - 詳細表示ボタンとモーダル/ページ遷移
  - プロンプト全文の表示
  - 入力パラメータの表示
  - 履歴からのコピー機能
  - 削除ボタンと削除処理
  - _Requirements: 4.3, 4.4, 4.5_

- [ ] 6.5 プロンプト履歴検索機能の実装
  - 検索ボックスのUI作成
  - キーワード検索機能
  - 全文検索インデックスの活用
  - 検索結果のハイライト表示
  - _Requirements: 4.6_

- [ ] 7. ナビゲーションとレイアウトの構築
- [ ] 7.1 グローバルナビゲーションの実装
  - ナビゲーションメニューのUI作成
  - 各機能へのリンク（ツール一覧、プロンプト生成、履歴）
  - アクティブページのハイライト
  - ユーザー表示とログアウトボタン
  - _Requirements: 7.2_

- [ ] 7.2 レスポンシブレイアウトとモバイル対応の実装
  - PCとモバイルで切り替わるレイアウト
  - ハンバーガーメニュー（モバイル）
  - タッチ操作への最適化
  - ビューポート設定とメタタグ
  - _Requirements: 7.1_

- [ ] 7.3 共通UIコンポーネントの実装
  - ローディングスピナー
  - トーストメッセージ（成功、エラー）
  - 確認ダイアログ
  - エラーバウンダリ
  - _Requirements: 7.4_

- [ ] 8. データ共有と同期の実装
- [ ] 8.1 ユーザーコンテキストと権限管理の実装
  - UserContextの作成
  - 現在ログインユーザーの取得
  - ユーザーIDのServer Actions内での検証
  - 権限チェックロジック
  - _Requirements: 5.6, 6.1, 6.3_

- [ ] 8.2 共有データのアクセス制御の実装
  - すべてのユーザーが全データを閲覧できるロジック
  - 登録者フィルタの実装（オプション）
  - 作成者名の一貫した表示
  - Row Level Securityの検証
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [ ] 8.3 他ユーザー作成データ編集時の確認機能の実装
  - 編集・削除前の作成者チェック
  - 他ユーザーのデータ編集時の確認ダイアログ
  - 確認ダイアログのUI実装
  - キャンセル処理
  - _Requirements: 6.5_

- [ ] 9. エラーハンドリングとロギングの実装
- [ ] 9.1 統一エラーハンドリングの実装
  - Result型パターンの全サービスへの適用
  - エラータイプの定義（4xx、5xx、422）
  - エラーメッセージの多言語対応
  - エラー境界の設定
  - _Requirements: 全要件のエラーハンドリング_

- [ ] 9.2 ユーザーフィードバックの実装
  - 成功メッセージの表示
  - エラーメッセージの表示
  - ローディング状態の表示
  - 進行状況インジケーター
  - _Requirements: 7.4_

- [ ] 9.3 ロギングとモニタリングの実装
  - 構造化ログの実装
  - エラーログの記録
  - パフォーマンスログの記録
  - ヘルスチェックエンドポイント（/api/health）の実装
  - _Requirements: エラーハンドリングとモニタリング_

- [ ] 10. テストの実装
- [ ] 10.1 ユニットテストの実装
  - ToolManagementServiceのテスト
  - PromptGenerationServiceのテスト
  - AuthServiceのテスト
  - SearchServiceのテスト
  - バリデーション関数のテスト
  - _Requirements: 全要件の品質保証_

- [ ] 10.2 統合テストの実装
  - AIツール登録フローのテスト
  - プロンプト生成フローのテスト
  - 認証フローのテスト
  - データ共有フローのテスト
  - 検索・フィルタリングフローのテスト
  - _Requirements: 全要件の統合動作確認_

- [ ] 10.3 E2Eテストの実装
  - ログインとログアウトのテスト
  - AIツール登録と編集のテスト
  - Sora2プロンプト生成のテスト
  - 履歴検索と再利用のテスト
  - レスポンシブUIのテスト
  - _Requirements: 全要件のユーザーシナリオ検証_

- [ ] 11. パフォーマンス最適化と最終調整
- [ ] 11.1 フロントエンド最適化の実装
  - React Server Componentsの最適化
  - コード分割と動的インポート
  - 画像最適化（Next.js Image）
  - Lazy Loadingの実装
  - _Requirements: 7.1（パフォーマンス要件）_

- [ ] 11.2 バックエンド最適化の実装
  - データベースインデックスの検証
  - クエリ最適化とN+1問題の解消
  - キャッシング戦略の実装
  - コネクションプーリングの設定
  - _Requirements: パフォーマンス要件_

- [ ] 11.3 セキュリティの最終確認
  - CSRFトークンの検証
  - XSS対策の確認
  - SQLインジェクション対策の検証
  - 環境変数の安全性確認
  - Row Level Securityの検証
  - _Requirements: 5.1-5.6（セキュリティ要件）_

- [ ] 11.4 デプロイ準備とVercel設定
  - 本番環境用環境変数の設定
  - Vercelプロジェクトの作成
  - カスタムドメインの設定（オプション）
  - CI/CDパイプラインの確認
  - ビルド成功の検証
  - _Requirements: デプロイメント_
