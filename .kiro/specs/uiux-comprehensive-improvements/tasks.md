# Implementation Plan

## Phase 1: 基盤整備とフィードバックシステム（優先度：高）

- [ ] 1. トースト通知システムの統一実装
- [ ] 1.1 カスタムToastラッパーの作成
  - sonnerライブラリのラッパー関数を実装し、success、error、warning、infoの4種類のメッセージタイプをサポート
  - 各メッセージタイプにTailwind CSS変数（--primary、--destructive等）を使用した統一スタイルを適用
  - 成功メッセージは3秒、エラーメッセージは5秒の表示時間を設定
  - 画面上部中央への配置、自動スタック管理、スワイプ削除機能を提供
  - _Requirements: 2.1, 2.2, 2.5, 2.6, 2.8_

- [ ] 1.2 既存Server Actionsへのトースト通知統合
  - AIツール登録、編集、削除の各Server ActionにToastラッパーを統合
  - プロンプト生成、履歴管理の各Server Actionにトースト通知を追加
  - ログイン・ログアウト処理にフィードバックメッセージを表示
  - エラー発生時にユーザーが理解しやすい日本語メッセージを表示
  - _Requirements: 2.1, 2.2, 2.7_

- [ ] 2. スケルトンスクリーンコンポーネントの実装
- [ ] 2.1 基本スケルトンコンポーネントの作成
  - 再利用可能なSkeletonコンポーネントを作成し、アニメーション効果を適用
  - ToolCard、PromptHistoryCard形状に一致するSkeletonCardを実装
  - フォームレイアウトに一致するSkeletonFormを作成
  - テーブルレイアウト用のSkeletonTableを作成（行数を動的に指定可能）
  - _Requirements: 3.1, 3.4_

- [ ] 2.2 ルートセグメント用ローディングファイルの追加
  - app/tools/loading.tsxを作成し、ツール一覧用のスケルトンを6個表示
  - app/prompt/loading.tsxを作成し、フォームスケルトンを表示
  - app/history/loading.tsxを作成し、履歴テーブルスケルトンを表示
  - app/tools/[id]/loading.tsxを作成し、詳細ページ用スケルトンを表示
  - _Requirements: 3.2, 3.4, 3.5_

- [ ] 3. ボタンとフォームのローディング状態管理
- [ ] 3.1 ボタンコンポーネントのローディング状態追加
  - Buttonコンポーネントにisloadingプロパティを追加
  - ローディング中はボタンを無効化し、Loaderアイコン（スピナー）を表示
  - ツール登録フォーム、編集フォーム、削除ボタンに適用
  - プロンプト生成ボタンにローディングスピナーを追加
  - _Requirements: 3.3, 3.8_

- [ ] 3.2 フォーム送信時の重複防止機能
  - react-hook-formのisSubmittingステートを活用
  - フォーム送信中は送信ボタンを無効化
  - 送信開始から0.5秒以内にローディング表示を開始
  - Server Action完了後にボタンを再有効化
  - _Requirements: 3.5, 3.8_

## Phase 2: レスポンシブデザインの最適化（優先度：高）

- [ ] 4. ナビゲーションのレスポンシブ対応強化
- [ ] 4.1 Navbarコンポーネントのモバイル最適化
  - モバイル（640px未満）でハンバーガーメニュー、デスクトップ（768px以上）で横並びナビゲーションを表示
  - タッチターゲットサイズを最小44x44pxに設定（モバイルボタン）
  - ロゴテキストをレスポンシブに調整（モバイル：短縮版、デスクトップ：完全版）
  - Sheetコンポーネントのモバイルメニュー幅を調整（280px → 350px）
  - _Requirements: 1.1, 1.2, 1.3, 1.7_

- [ ] 4.2 Navbarのアクセシビリティ向上
  - ハンバーガーメニューボタンにaria-label属性を追加
  - フォーカスインジケーターを明確に表示（focus-visible）
  - Escキーでモバイルメニューを閉じる機能を確認
  - _Requirements: 6.2, 6.3, 6.4, 7.5_

- [ ] 5. カードレイアウトの一貫性とレスポンシブ対応
- [ ] 5.1 カードグリッドのレスポンシブ調整
  - ツール一覧ページでモバイル1列、タブレット2列、デスクトップ3列のグリッドレイアウトを実装
  - プロンプト履歴ページで同様のレスポンシブグリッドを適用
  - カードグリッドのギャップ（gap-4）を全ページで統一
  - コンテナの最大幅とパディングを調整（container mx-auto px-4）
  - _Requirements: 1.2, 1.5, 5.7_

- [ ] 5.2 カードコンポーネントのスタイル統一
  - ToolCard、PromptHistoryCardのパディング、角丸、影を統一
  - カードホバー時の視覚的フィードバックを追加（shadow-md → shadow-lg）
  - カードヘッダーの情報配置を統一（タイトル、日時、作成者）
  - アクションボタンの配置を右上または下部で統一
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [ ] 5.3 空状態とプレースホルダーの統一
  - カードが存在しない場合の空状態UIを統一
  - カード内画像のアスペクト比と表示サイズを統一
  - プレースホルダーテキストとアイコンのスタイルを統一
  - _Requirements: 5.5, 5.6_

- [ ] 6. フォームレイアウトのレスポンシブ最適化
- [ ] 6.1 フォームのモバイル最適化
  - ツール登録・編集フォームをモバイルで1カラム、デスクトップで2カラムレイアウトに調整
  - プロンプト生成フォームをモバイルで縦スクロール可能に調整
  - ログインフォームをモバイルで中央寄せ、適切なパディングを設定
  - フォントサイズを最小14px以上に統一（モバイル）
  - _Requirements: 1.1, 1.4, 1.6_

- [ ] 6.2 デバイスの向き変更対応
  - ビューポートメタタグの確認（既存のapp/layout.tsx）
  - レイアウトがデバイス向き変更時に即座に再調整されることを検証
  - _Requirements: 1.8_

## Phase 3: フォーム入力UXの向上（優先度：中）

- [ ] 7. フォーム入力フィールドの機能強化
- [ ] 7.1 入力フィールドの視覚的改善
  - 明確なラベルとプレースホルダーテキストを全フォームに提供
  - フォーカス時のハイライト表示を強化（ring-2、ring-primary）
  - 必須フィールドにアスタリスク（*）または「必須」ラベルを表示
  - _Requirements: 4.1, 4.2, 4.3_

- [ ] 7.2 リアルタイムバリデーションの実装
  - フィールドフォーカス離脱時（onBlur）にバリデーションを実行
  - エラーがあるフィールドに赤枠（border-destructive）とエラーメッセージを即座に表示
  - Zodスキーマによるバリデーションルールを明確に定義
  - _Requirements: 4.4, 2.3_

- [ ] 7.3 文字数カウンターの追加
  - 長文入力フィールド（Textarea）に文字数カウンターを追加
  - 最大文字数を表示（例：「120/500文字」）
  - 最大文字数を超えた場合に警告表示
  - _Requirements: 4.7_

- [ ] 7.4 フォーカス管理とスクロール機能
  - フォーム送信時にバリデーションエラーがある場合、最初のエラーフィールドにフォーカスとスクロール
  - focusFirstError関数を実装し、react-hook-formと統合
  - _Requirements: 4.8_

- [ ] 7.5 入力補助機能の追加
  - 入力例やヘルプテキストをツールチップまたは補助テキストで提供
  - 日付入力フィールドでHTML5 date inputを使用（ブラウザネイティブカレンダーピッカー）
  - _Requirements: 4.5, 4.9_

- [ ] 8. 削除操作の確認ダイアログ強化
- [ ] 8.1 削除確認ダイアログの改善
  - ツール削除ボタンにAlertDialogを使用し、操作内容を明示
  - ダイアログタイトルと説明文で削除対象を具体的に表示
  - キャンセルボタンと削除ボタンを明確に区別（色とラベル）
  - _Requirements: 2.4_

## Phase 4: アクセシビリティの向上（優先度：中）

- [ ] 9. キーボードナビゲーションの実装
- [ ] 9.1 フォーカス順序とインジケーターの改善
  - Tab/Shift+Tabキーで論理的な順序でフォーカスが移動することを確認
  - 全インタラクティブ要素に明確なフォーカスインジケーター（ring-2、ring-offset-2）を表示
  - Tailwindのfocus-visibleクラスを使用
  - _Requirements: 6.1, 6.2, 6.7_

- [ ] 9.2 キーボード操作のサポート
  - Enter/Spaceキーでボタンとリンクをアクティベート可能に設定
  - フォームでEnterキーによる送信をサポート（Textareaを除く）
  - ドロップダウンメニュー（Select）で矢印キーによる選択肢移動をサポート
  - _Requirements: 6.3, 6.6, 6.8_

- [ ] 9.3 モーダルとダイアログのフォーカス管理
  - モーダル（Sheet、AlertDialog）でEscキーによる閉じる機能を確認
  - モーダル開時にフォーカスをモーダル内に閉じ込め（focus trap）
  - useFocusTrapフックを実装
  - モーダル閉時に元の要素にフォーカスを復元（useFocusRestoration）
  - _Requirements: 6.4, 6.5_

- [ ] 10. スクリーンリーダー対応の実装
- [ ] 10.1 ARIA属性の追加
  - 全画像にalt属性を提供（意味のある説明）
  - アイコンのみのボタンにaria-label属性を追加
  - フォームラベルをlabel要素で入力フィールドと明示的に関連付け
  - _Requirements: 7.1, 7.2, 7.3, 7.5_

- [ ] 10.2 セマンティックHTML要素の使用
  - header、nav、main、footer要素をレイアウトに適切に配置
  - 見出し階層（h1、h2、h3）を適切に設定
  - _Requirements: 7.7, 7.4_

- [ ] 10.3 動的コンテンツのアナウンス
  - aria-liveリージョンをapp/layout.tsxに追加（role="status"、role="alert"）
  - ARIAアナウンサー関数（announce）を実装
  - トースト表示時にaria-liveリージョンへメッセージを送信
  - エラーメッセージ表示時にaria-invalidとrole="alert"を設定
  - _Requirements: 7.6, 7.8_

## Phase 5: パフォーマンス最適化（優先度：中）

- [ ] 11. 画像最適化の実装
- [ ] 11.1 next/imageコンポーネントへの移行
  - 既存のimg要素をnext/imageコンポーネントに置き換え
  - width、height属性を指定してCLS（Cumulative Layout Shift）を防止
  - loading="lazy"でスクロール時の遅延読み込みを有効化
  - sizes属性でレスポンシブ画像サイズを指定
  - _Requirements: 8.2, 8.3, 8.5_

- [ ] 11.2 画像形式の最適化
  - next/imageが自動的にWebP/AVIF形式で配信することを確認
  - 画像ファイルを適切なサイズに圧縮
  - _Requirements: 8.2_

- [ ] 12. コード分割とフォント最適化
- [ ] 12.1 動的インポートによるコード分割
  - 大きなコンポーネント（PromptGenerator等）をnext/dynamicで動的インポート
  - 初回読み込みサイズを最小化し、ルートセグメント単位で分割
  - Suspenseとloading.tsxを活用したストリーミング表示
  - _Requirements: 8.4_

- [ ] 12.2 フォント最適化
  - app/layout.tsxでnext/font/googleを使用してフォントを最適化
  - font-display: swapを設定し、テキストの即座表示を保証
  - フォントのサブセット読み込みを確認
  - _Requirements: 8.6_

- [ ] 13. アニメーションとパフォーマンスの最適化
- [ ] 13.1 CSSアニメーションの最適化
  - transform、opacityプロパティを使用したアニメーション（レイアウト再計算回避）
  - ボタンホバー時のtransition-colorsを確認
  - カードホバー時のshadow transitionを最適化
  - _Requirements: 8.8_

- [ ] 13.2 キャッシュ戦略の確認
  - Next.js自動キャッシュ（_next/static/）の動作確認
  - next/imageによる画像キャッシュヘッダーの確認
  - _Requirements: 8.7_

## Phase 6: テストと検証（優先度：中）

- [ ] 14. レスポンシブデザインのテスト
- [ ] 14.1 マルチデバイステスト
  - モバイル（320px、375px、414px）でレイアウトを確認
  - タブレット（768px、1024px）でレイアウトを確認
  - デスクトップ（1280px、1440px、1920px）でレイアウトを確認
  - タッチターゲットサイズ（44px以上）を検証
  - _Requirements: 1.1, 1.2, 1.7_

- [ ] 14.2 デバイス向き変更テスト
  - ポートレート/ランドスケープ切り替え時のレイアウト調整を確認
  - _Requirements: 1.8_

- [ ] 15. アクセシビリティ監査
- [ ] 15.1 キーボードナビゲーションテスト
  - キーボードのみで全ページを操作可能か確認
  - フォーカス順序が論理的か確認
  - モーダルのフォーカストラップとEscキーによる閉じる機能を確認
  - _Requirements: 6.1, 6.4, 6.5_

- [ ] 15.2 スクリーンリーダーテスト
  - NVDA/JAWSでページを読み上げテスト
  - ARIA属性が正しく読み上げられるか確認
  - 動的コンテンツ変更時のアナウンスを確認
  - _Requirements: 7.1, 7.2, 7.6, 7.8_

- [ ] 16. パフォーマンステスト
- [ ] 16.1 Web Vitals測定
  - Lighthouseを実行してFCP、LCP、CLS、TTIを測定
  - FCP < 3秒、LCP < 2.5秒、CLS < 0.1、TTI < 5秒を目標に最適化
  - _Requirements: 8.1_

- [ ] 16.2 バンドルサイズ分析
  - next build後にJavaScriptバンドルサイズを確認
  - 初回読み込みサイズが200KB gzipped以下か確認
  - _Requirements: パフォーマンス最適化全般_

## Phase 7: 統合テストとリグレッションテスト

- [ ] 17. E2Eテストの実装
- [ ] 17.1 重要ユーザーフローのテスト
  - AIツール登録フロー（モバイル）: フォーム入力 → ローディング → 成功トースト → 一覧ページ遷移
  - ツール一覧閲覧（タブレット）: スケルトン表示 → 2カラムグリッド → カードホバー
  - キーボードナビゲーション（デスクトップ）: Tab移動 → Enter遷移
  - エラーハンドリング: 無効データ送信 → エラーメッセージ → フォーカス移動
  - _Requirements: 全要件の統合確認_

- [ ] 17.2 リグレッションテスト
  - 既存機能が正しく動作することを確認
  - Google OAuth認証フローの動作確認
  - AIツールCRUD操作の動作確認
  - プロンプト生成機能の動作確認
  - _Requirements: 全要件の後方互換性確認_

---

**総タスク数**: 17メジャータスク、44サブタスク
**実装期間**: 10-14日間（Phase 1-4: 8-11日、Phase 5-7: 2-3日）
**優先順位**: Phase 1-2（高）→ Phase 3-4（中）→ Phase 5-7（中）
